(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();let re={};AFRAME.registerComponent("move-to",{schema:{to:{type:"vec3"},duration:{type:"number",default:3e3}},init:function(){let e=this.el.getAttribute("position");this.startPos=new THREE.Vector3(e.x,e.y,e.z),this.endPos=new THREE.Vector3(this.data.to.x,this.data.to.y,this.data.to.z),this.elapsedTime=0,this.moving=!0},tick:function(e,t){if(!this.moving)return;this.elapsedTime+=t;let o=Math.min(this.elapsedTime/this.data.duration,1),n=new THREE.Vector3().lerpVectors(this.startPos,this.endPos,o);this.el.setAttribute("position",`${n.x} ${n.y} ${n.z}`),o>=1&&(this.moving=!1)}});re.moveCameraVR=function(e,t,o){let n=document.querySelector("#rig");n.setAttribute("position",`${e.x} ${e.y} ${e.z}`),n.setAttribute("move-to",`to: ${t.x} ${t.y} ${t.z}; duration: ${o}`)};let ie={};ie.setupControllerClickHandler=function(){AFRAME.registerComponent("occulus-grab",{init:function(){let e=this.el,t=!1,o=null;this.onGrabStart=n=>{let r=n.target.components.raycaster;if(!r)return;let i=r.intersectedEls;i.length===0||i[0]!==e||(t=!0,o=n.target,e.setAttribute("dynamic-body","mass: 0"),e.setAttribute("grab",""),o.addEventListener("triggerup",this.onGrabEnd))},this.onGrabEnd=()=>{t&&(e.setAttribute("dynamic-body","mass: 1; restitution: 0.5; friction: 0.5"),e.removeAttribute("grab"),t=!1,o.removeEventListener("triggerup",this.onGrabEnd),o=null)},this.tick=function(){if(t&&o){let n=new THREE.Vector3,r=new THREE.Quaternion;o.object3D.getWorldPosition(n),o.object3D.getWorldQuaternion(r);let i=new THREE.Vector3(-.5,-1.8,-2.7);i.applyQuaternion(r);let p=n.clone().add(i);e.object3D.position.copy(p)}},e.sceneEl.addEventListener("triggerdown",this.onGrabStart)}})};window.addEventListener("load",function(){const e=document.getElementById("progress-bar");let t=0;const o=setInterval(function(){t>=100?(clearInterval(o),setTimeout(function(){document.getElementById("progress-bar-container").style.display="none";const n=document.querySelector("a-scene");n.style.display="block",setTimeout(function(){console.log("Déplacer le joueur en 8 secondes plus optimisation et fix loading screen et position 1.5 et corrextion loding screnn puis clique fix"),n.setAttribute("cursor","rayOrigin: mouse; "),re.moveCameraVR({x:0,y:2.2,z:0},{x:1.237,y:1.5,z:-35},8e3)},500)},1e3)):(t++,e.style.width=t+"%")},10)});let Q={};Q.getAll=function(){return data};Q.getTopUsers=async function(){return await(await fetch("https://mmi.unilim.fr/~savary23/Let_Him_Quizz/api/user?param=top10")).json()};Q.addUser=async function(e,t){await fetch("https://mmi.unilim.fr/~savary23/Let_Him_Quizz/api/user?param=addUser&username="+e+"&score="+t)};let Z={};const pe=document.querySelector("#mainScene"),fe=await fetch("./src/components/leaderboard/template.html.inc"),ye=await fe.text();Z.renderZone=async function(){let e=await Q.getTopUsers();document.querySelector("#scoreboard")&&Z.remove();const t=document.createElement("div");t.id="leaderboardZone";let o=ye;e.forEach((r,i)=>{o=o.replace(`{{user${i+1}}}`,`${i+1}. `+r.username).replace(`{{score${i+1}}}`,r.score)});for(let r=e.length;r<10;r++)o=o.replace(`{{user${r+1}}}`,"").replace(`{{score${r+1}}}`,"");t.innerHTML=o,t.querySelectorAll("#scoreboard").forEach(r=>{pe.appendChild(r)})};Z.remove=function(){document.querySelector("#scoreboard").remove()};let ee={},z=[];ee.getAll=function(){return data};ee.getRandomPlace=async function(){let e;do e=await(await fetch("https://mmi.unilim.fr/~savary23/Let_Him_Quizz/api/place?param=random")).json();while(z.includes(e.id));let t=e.img,o=[e.reponse1,e.reponse2,e.reponse3,e.reponse4];return z.push(e.id),z.length>10&&z.shift(),{placeImage:t,propositions:o}};let K=await fetch("./src/data/json/mcq.json");K=await K.json();let G={},F=[];G.getAll=function(){return K};G.getRandomQuestion=async function(e){let t;do t=await(await fetch("https://mmi.unilim.fr/~savary23/Let_Him_Quizz/api/MCQ?difficulty="+e+"&category="+window.category)).json();while(F.includes(t.id));let o=t.question,n=[t.reponse1,t.reponse2,t.reponse3,t.reponse4];return F.push(t.id),F.length>10&&F.shift(),{question:o,propositions:n}};const he=await fetch("./src/components/money-counter/template.html.inc"),Se=await he.text(),we=await fetch("./src/components/money-counter/money-template.html.inc"),ge=await we.text(),se=document.querySelector("#mainScene");let u={},x=0;u.renderMoneyZone=function(){const e=document.createElement("div");e.id="moneyZone",e.innerHTML=Se,e.querySelectorAll("#moneyZone").forEach(o=>{se.appendChild(o)})};u.removeMoneyZone=function(){document.querySelector("#moneyZone").remove()};u.summonStack=function(e){for(let t=0;t<e;t++)setTimeout(()=>{const o=document.createElement("div");o.id="moneyStack";const n=Math.random()*1-5,r=Math.random()*1-41;o.innerHTML=ge.replace("{{x}}",n).replace("{{z}}",r);const i=o.querySelector("#moneyStack");se.appendChild(i),x=x+50,u.updateMoney(x),setTimeout(()=>{i.removeAttribute("dynamic-body"),i.setAttribute("static-body","")},3e3)},t*500)};u.updateMoney=async function(e){await document.querySelector("#moneyCount a-text").setAttribute("value",`$${e} `)};u.getMoney=function(){return x};u.setMoney=function(e){return x=e,u.updateMoney(x),x};u.removeMoney=function(e){const t=document.querySelectorAll("#moneyStack");x=x-50*e,u.updateMoney(x);for(let o=0;o<e;o++)t[o]&&setTimeout(()=>{t[o].remove()},o*100)};u.removeAllMoneyStack=function(){document.querySelectorAll("#moneyStack").forEach(t=>t.remove())};let v={};v.changeColor=function(e){document.querySelectorAll(".light").forEach(o=>{o.setAttribute("animation__color",{property:"light.color",to:e,dur:500,easing:"easeInOutQuad"})})};v.resetColor=function(){v.changeColor("#FFFFFF")};v.flashColor=function(e){v.changeColor(e),setTimeout(()=>{v.resetColor()},1e3)};const C={correctAnswerSound:"./src/assets/audio/correct-choice.mp3",wrongAnswerSound:"./src/assets/audio/wrong-choice.mp3",tictacSound:"./src/assets/audio/tic-tac.mp3",tictacEndingSound:"./src/assets/audio/timer-ending.mp3",swooshSound:"./src/assets/audio/swoosh.mp3",keyboardSound:"./src/assets/audio/keyboard.wav",ostSound:"./src/assets/audio/ost.mp3"};let d={};d.renderCorrectAnswer=function(){const e=document.getElementById("correctAnswerSound");e.src=C.correctAnswerSound,e?e.play():console.error('Element with id "correctAnswerSound" not found.')};d.renderWrongAnswer=function(){const e=document.getElementById("wrongAnswerSound");e.src=C.wrongAnswerSound,e?e.play():console.error('Element with id "wrongAnswerSound" not found.')};d.renderTictac=function(){const e=document.getElementById("tictacSound");e.src=C.tictacSound,e?e.play():console.error('Element with id "tictacSound" not found.')};d.stopTictac=function(){const e=document.getElementById("tictacSound");e?e.pause():console.error('Element with id "tictacSound" not found.')};d.renderTictacEnding=function(){const e=document.getElementById("tictacEndingSound");e.src=C.tictacEndingSound,e?e.play():console.error('Element with id "tictacEndingSound" not found.')};d.renderSwoosh=function(){const e=document.getElementById("swooshSound");e.src=C.swooshSound,e?e.play():console.error('Element with id "swooshSound" not found.')};d.keyboardSound=function(){const e=document.getElementById("keyboardSound");e.src=C.keyboardSound,e?e.play():console.error('Element with id "keyboardSound" not found.')};d.renderOST=function(){const e=document.getElementById("ostSound");e.src=C.ostSound,e?e.play():console.error('Element with id "ostSound" not found.')};const be=await fetch("src/components/ticking-away/template.html.inc");await be.text();document.querySelector("#mainScene");document.querySelector("#timer");let g={};g.anchormanCheer=function(){document.querySelector("#anchorman").setAttribute("animation-mixer",{clip:"HumanArmature|Man_Clapping",loop:"once"}),setTimeout(()=>{g.anchormanIdle()},1800)};g.anchormanIdle=function(){document.querySelector("#anchorman").setAttribute("animation-mixer",{clip:"HumanArmature|Man_Idle"})};g.audienceCheer=function(){document.querySelectorAll(".audience-member").forEach(t=>{t.setAttribute("animation-mixer",{clip:"Armature|Jump",loop:"once"})}),setTimeout(()=>{g.audienceIdle()},1e3)};g.anchormanDeception=function(){document.querySelector("#anchorman").setAttribute("animation-mixer",{clip:"HumanArmature|Man_SwordSlash",loop:"once"}),setTimeout(()=>{g.anchormanIdle()},1e3)};g.keyPressed=function(e){e.setAttribute("animation",{property:"scale",to:"0.8 0.8 0.8",dur:100,dir:"alternate",loop:"2"}),setTimeout(()=>{e.removeAttribute("animation")},300)};const ve=await fetch("./src/components/ticking-away/template.html.inc"),Ae=await ve.text(),Ee=document.querySelector("#mainScene");document.querySelector("#timer");let M=0,A={},X=!1;A.renderQuizZone=function(){const e=document.createElement("div");e.id="quizZone",e.innerHTML=Ae,e.querySelectorAll("#quizZone").forEach(n=>{Ee.appendChild(n)}),document.querySelectorAll(".answer").forEach(n=>{n.addEventListener("click",A.answerClicked)})};A.removeQuizZone=function(){const e=document.querySelector("#quizZone");e.setAttribute("animation",{property:"position",to:"0.99 -3 -36",dur:1e3,easing:"easeInOutQuad"}),setTimeout(()=>{e.remove()},1e3)};A.newQuestion=async function(){X=!1,document.querySelectorAll(".answer a-box").forEach(n=>{n.setAttribute("color","#FF662F")});let e=await G.getRandomQuestion("medium");document.querySelector("#question a-text").setAttribute("value",e.question);let t=e.propositions.slice();for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}document.querySelectorAll(".answer a-box").forEach(n=>{n.getAttribute("id")==="good answer"&&n.removeAttribute("id")}),document.querySelector("#answer1 a-text").setAttribute("value",t[0]),document.querySelector("#answer2 a-text").setAttribute("value",t[1]),document.querySelector("#answer3 a-text").setAttribute("value",t[2]),document.querySelector("#answer4 a-text").setAttribute("value",t[3]);const o=t.indexOf(e.propositions[0]);document.querySelector(`#answer${o+1} a-box`).setAttribute("id","good answer")};A.answerClicked=function(e){if(X)return;document.querySelectorAll(".answer a-box").forEach(o=>{o.getAttribute("id")==="good answer"?o.setAttribute("color","#00ff00"):o.setAttribute("color","#ff0000")});const t=document.querySelector(`#${e.target.parentElement.id} a-box`);t.removeAttribute("animation"),t.setAttribute("animation","property: scale; to: 1.1 1.1 1.1; dur: 100; loop: 2; dir: alternate"),t.id==="good answer"?(v.flashColor("#00ff00"),g.anchormanCheer(),g.audienceCheer(),d.renderCorrectAnswer(),setTimeout(()=>{A.newQuestion()},500),u.summonStack(2)):(v.flashColor("#ff0000"),g.anchormanDeception(),d.renderWrongAnswer(),setTimeout(()=>{A.newQuestion()},2e3)),X=!0};A.startTimer=function(){M=0;let e=30;d.renderTictac(),document.querySelector("#timer a-text").setAttribute("value",e-M);const t=setInterval(()=>{M++,document.querySelector("#timer a-text").setAttribute("value",e-M),M===e&&(clearInterval(t),c.nextRound(),d.stopTictac(),d.renderTictacEnding())},1e3)};const qe=await fetch("./src/components/find-the-place/template.html.inc"),xe=await qe.text(),ae=document.querySelector("#mainScene");let B=0,_=0,D=!1,w={};w.renderPropositionsZone=function(){_>=3&&(_=0);const e=document.createElement("div");e.id="propositionsZone",e.innerHTML=xe,e.querySelectorAll("#propositionsZone").forEach(n=>{ae.appendChild(n)}),document.querySelectorAll(".answer").forEach(n=>{n.addEventListener("click",w.answerClicked)})};w.removeQuizZone=function(){const e=document.querySelector("#propositionsZone");e.setAttribute("animation",{property:"position",to:"0.99 -3 -36",dur:1e3,easing:"easeInOutQuad"}),setTimeout(()=>{e.remove()},800)};w.renderQuestion=async function(){let e=await ee.getRandomPlace();const t=document.createElement("a-sky");t.setAttribute("class","interactable"),t.setAttribute("position","1.237 3 -35.03326"),t.setAttribute("id","360Sky"),t.setAttribute("radius","2"),t.setAttribute("src",`./src/assets/360locations/${e.placeImage}`),t.setAttribute("animation__enter","property: position; from: 1.237 3 -40; to: 1.237 3 -35.03326; dur: 3000; easing: easeInOutQuad"),t.setAttribute("animation__scale","property: scale; from: 0.1 0.1 -0.1; to: 1 1 -1; dur: 3000; easing: easeInOutQuad"),t.setAttribute("animation__exit","property: position; to: 1.237 -10 -35.03326; delay:10000; dur: 3000; easing: easeInOutQuad"),ae.appendChild(t);let o=e.propositions.slice();for(let r=o.length-1;r>0;r--){const i=Math.floor(Math.random()*(r+1));[o[r],o[i]]=[o[i],o[r]]}document.querySelector("#answer1 a-text").setAttribute("value",o[0]),document.querySelector("#answer2 a-text").setAttribute("value",o[1]),document.querySelector("#answer3 a-text").setAttribute("value",o[2]),document.querySelector("#answer4 a-text").setAttribute("value",o[3]);const n=o.indexOf(e.propositions[0]);document.querySelector(`#answer${n+1} a-box`).setAttribute("id","good answer")};w.answerClicked=function(e){if(D)return;document.querySelectorAll(".answer a-box").forEach(o=>{o.getAttribute("id")==="good answer"?o.setAttribute("color","#00ff00"):o.setAttribute("color","#ff0000")});const t=document.querySelector(`#${e.target.parentElement.id} a-box`);t.removeAttribute("animation"),t.setAttribute("animation","property: scale; to: 1.1 1.1 1.1; dur: 100; loop: 2; dir: alternate"),t.id==="good answer"?(d.renderCorrectAnswer(),v.flashColor("#00ff00"),g.anchormanCheer(),g.audienceCheer(),setTimeout(()=>{w.newRound()},1e3),u.summonStack(6)):(d.renderWrongAnswer(),v.flashColor("#ff0000"),g.anchormanDeception(),setTimeout(()=>{w.newRound()},1e3)),D=!0};w.startTimer=function(){B=0,document.querySelector("#timer a-text").setAttribute("value",B),setInterval(()=>{B++,document.querySelector("#timer a-text").setAttribute("value",B),B===7&&w.removeQuizZone()},1e3)};w.newRound=function(){_++,_===3?(D=!1,c.nextRound()):(document.getElementById("360Sky").remove(),w.removeQuizZone(),setTimeout(()=>{w.renderPropositionsZone(),w.renderQuestion(),D=!1},1200))};const Te=await fetch("./src/components/sorrynotsorich/template.html.inc"),ke=await Te.text(),Ce=await fetch("./src/components/sorrynotsorich/money-template.html.inc");await Ce.text();const Ie=document.querySelector("#mainScene");let E={},k=0,J=0;E.renderQuizZone=function(){const e=document.createElement("div");for(e.id="sorryNotSoRichDiv",e.innerHTML=ke,J=0;e.firstChild;)Ie.appendChild(e.firstChild);E.newQuestion()};E.newQuestion=async function(){if(J++,J===4){setTimeout(()=>{c.nextRound()},1500);return}let e=await G.getRandomQuestion("hard");document.querySelectorAll(".answer a-box").forEach(n=>{n.setAttribute("color","#3246E7")}),k=0,document.querySelector("#question a-text").setAttribute("value",e.question);let t=e.propositions.slice();for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}document.querySelectorAll(".good-answer").forEach(n=>{n.classList.remove("good-answer")}),document.querySelectorAll(".good-answerbox").forEach(n=>{n.classList.remove("good-answerbox")}),document.querySelector("#answer1 a-text").setAttribute("value",t[0]),document.querySelector("#answer2 a-text").setAttribute("value",t[1]),document.querySelector("#answer3 a-text").setAttribute("value",t[2]),document.querySelector("#answer4 a-text").setAttribute("value",t[3]);const o=t.indexOf(e.propositions[0]);document.querySelector(`#bet${o+1}`).classList.add("good-answer"),document.querySelector(`#answer${o+1}`).classList.add("good-answerbox"),E.calculateMoney()};E.updateAnswerColors=function(){[document.querySelector("#answer1 a-box"),document.querySelector("#answer2 a-box"),document.querySelector("#answer3 a-box"),document.querySelector("#answer4 a-box")].forEach(t=>{t.parentElement.classList.contains("good-answerbox")?t.setAttribute("color","green"):t.setAttribute("color","red")})};E.calculateMoney=function(){let e=u.getMoney();const t=[document.querySelector("#bet1"),document.querySelector("#bet2"),document.querySelector("#bet3"),document.querySelector("#bet4")],o=[document.querySelector("#plus1"),document.querySelector("#plus2"),document.querySelector("#plus3"),document.querySelector("#plus4")],n=[document.querySelector("#minus1"),document.querySelector("#minus2"),document.querySelector("#minus3"),document.querySelector("#minus4")],r=[document.querySelector("#trap1"),document.querySelector("#trap2"),document.querySelector("#trap3"),document.querySelector("#trap4")];t.forEach(s=>s.setAttribute("value","$0"));const i=()=>{k=t.reduce((s,a)=>s+parseInt(a.getAttribute("value").replace("$","")),0),u.updateMoney(e-k),k===e&&u.removeAllMoneyStack()},p=()=>{const s=k===e;o.forEach(a=>a.setAttribute("visible",!s)),document.querySelector("#validButton").setAttribute("visible",s),document.querySelector("#validButton a-box").classList.toggle("interactable",s)},m=s=>k+s<=e,f=s=>{let a=parseInt(t[s].getAttribute("value").replace("$",""));m(100)&&(t[s].setAttribute("value",`$${a+100}`),u.removeMoney(2),N(s),i(),p(),n[s].setAttribute("visible",!0))},h=s=>{let a=parseInt(t[s].getAttribute("value").replace("$",""));a>0&&(t[s].setAttribute("value",`$${a-100}`),u.summonStack(2),V(s),i(),p(),document.querySelector("#validButton a-box").classList.remove("interactable")),parseInt(t[s].getAttribute("value").replace("$",""))===0&&n[s].setAttribute("visible",!1)},I=()=>{let s=document.querySelector(".good-answer");console.log("correctAnswerBox: "+s);let a=parseInt(s.getAttribute("value").replace("$","")),l=k/2;a>l&&(d.renderCorrectAnswer(),v.changeColor("green")),a<l&&(d.renderWrongAnswer(),v.changeColor("red")),a===l&&console.log("Tu perds autant d'argent que tu en conserves"),e=u.setMoney(a),setTimeout(()=>{W()},1500),E.updateAnswerColors();for(let b=1;b<=4;b++)d.renderSwoosh(),document.querySelector(`#bet${b}`).classList.contains("good-answer")||(document.querySelector(`#trap${b}`).removeAttribute("animation__rotation","property: rotation; to: 0 0 0; loop: false; dur: 1000"),document.querySelector(`#trap${b}`).setAttribute("animation__rotation","property: rotation; to: 90 0 0; loop: false; dur: 1000"));t.forEach(b=>b.setAttribute("value","$0")),setTimeout(()=>{if(a===0)console.log("You lost all your money!"),E.removeQuizZone(),u.removeAllMoneyStack();else{p(),i(),E.newQuestion();for(let b=1;b<=4;b++)document.querySelector(`#bet${b}`).classList.contains("good-answer")||(document.querySelector(`#trap${b}`).removeAttribute("animation__rotation","property: rotation; to: 90 0 0; loop: false; dur: 1000"),document.querySelector(`#trap${b}`).setAttribute("animation__rotation","property: rotation; to: 0 0 0; loop: false; dur: 1000"))}},2e3)},N=s=>{const a=r[s],l=document.createElement("a-entity");l.setAttribute("gltf-model","./src/assets/modele3d/money.glb");const b=a.querySelectorAll(".moneyStack").length,le=Math.floor(b/5),de=b%5*.1,me=le*.2;l.setAttribute("position",`${me} ${de} 0.75`),l.setAttribute("scale","0.4 0.4 0.4"),l.classList.add("moneyStack"),a.appendChild(l)},V=s=>{const a=r[s],l=a.querySelectorAll(".moneyStack");l.length>0&&a.removeChild(l[l.length-1])},W=()=>{r.forEach(s=>{s.querySelectorAll(".moneyStack").forEach(l=>s.removeChild(l))})},U=()=>{o.forEach((s,a)=>{s.addEventListener("click",()=>f(a))}),n.forEach((s,a)=>{s.addEventListener("click",()=>h(a))}),document.querySelector("#validButton").addEventListener("click",I)};o.forEach((s,a)=>{const l=s.cloneNode(!0);s.parentNode.replaceChild(l,s),o[a]=l}),n.forEach((s,a)=>{const l=s.cloneNode(!0);s.parentNode.replaceChild(l,s),n[a]=l}),document.querySelector("#validButton").replaceWith(document.querySelector("#validButton").cloneNode(!0)),n.forEach(s=>s.setAttribute("visible",!1)),document.querySelector("#validButton").setAttribute("visible",!1),document.querySelector("#validButton a-box").classList.remove("interactable"),U()};E.removeQuizZone=function(){const e=document.querySelector("#sorrynotsorich-container");setTimeout(()=>{e.remove()},800),e.setAttribute("animation",{property:"position",to:"0.99 -3 -36",dur:1e3,easing:"easeInOutQuad"})};let te={};te.getAll=function(){return data};te.getRandomSortItOut=async function(){let e=[],t;do t=await(await fetch("https://mmi.unilim.fr/~savary23/Let_Him_Quizz/api/sort?difficulty=hard")).json();while(e.includes(t.id));return e.push(t.id),e.length>3&&e.shift(),{difficulty:t.difficulty,id:t.id,question:t.question,responses:[R(t.reponse1),R(t.reponse2),R(t.reponse3),R(t.reponse4)]}};function R(e){let t=e.split("§");return{answer:t[0].trim(),solution:t[1]?t[1].trim():null}}let y={},P=!1,L=1;const ne=3;let O=!1;console.log("Can confirm:"+O);y.resetGameState=function(){P=!1,console.log("Game state reset. Rounds: "+L),v.resetColor()};async function $e(){const e=await fetch("./src/components/sort-it-out/template.html.inc");if(!e.ok)throw new Error("Failed to load template");return await e.text()}const Ze=document.querySelector("#mainScene");y.renderSortItOutZone=async function(){y.resetGameState();let e=await te.getRandomSortItOut();const t=await $e(),o=document.createElement("a-entity");o.id="sortItOutZone",o.innerHTML=t,Ze.appendChild(o);function n(m){for(let f=m.length-1;f>0;f--){const h=Math.floor(Math.random()*(f+1));[m[f],m[h]]=[m[h],m[f]]}}e.responses.forEach((m,f)=>{const h=document.querySelector(`#hollowBox${f+1}`);h&&h.setAttribute("data-valeur",m.answer)});const r=[...e.responses];n(r),r.forEach((m,f)=>{const h=document.querySelector(`#movableBox${f+1}`),I=document.querySelector(`#answer${f+1}`);h&&h.setAttribute("data-valeur",m.answer),I&&I.setAttribute("value",m.answer)}),document.querySelector("#question").setAttribute("value",e.question);const p=document.querySelector("#validButton");p&&p.addEventListener("click",()=>{O===!0&&y.CheckIfInside(e)}),document.querySelectorAll("#movableBox1, #movableBox2, #movableBox3, #movableBox4").forEach(m=>{m.setAttribute("draggable",""),m.setAttribute("occulus-grab","")}),y.setupDraggables()};y.removeSortItOutZone=function(){const e=document.querySelector("#sortItOutZone");e&&e.remove(),v.resetColor()};y.setupDraggables=function(){AFRAME.registerComponent("draggable",{init:function(){const e=this.el;let t=!1;e.addEventListener("mousedown",()=>{t=!0,e.setAttribute("dynamic-body","mass: 0")}),document.addEventListener("mousemove",o=>{if(t){O=!0;const r=document.querySelector("a-scene").components.raycaster.getIntersection(e);if(r){const i=r.point;e.setAttribute("position",`${i.x} ${i.y} ${e.getAttribute("position").z}`)}}}),document.addEventListener("mouseup",()=>{t&&(t=!1,e.setAttribute("dynamic-body","mass: 5"))})}})};y.resetCounter=function(){L=1};y.resetAndRenderZone=function(){L<ne?(L++,O=!1,console.log("Starting round "+L),y.removeSortItOutZone(),y.renderSortItOutZone()):(console.log("Game finished after "+ne+" rounds."),O=!1,y.removeSortItOutZone(),c.nextRound())};y.CheckIfInside=function(e){if(P)return;const t=document.querySelectorAll("[id^='movableBox']"),o=document.querySelectorAll("[id^='hollowBox']");let n=!0;t.forEach(r=>{const i=r.object3D.position;let p=!1;o.forEach(m=>{const f=m.object3D.position,h=.8,I=f.x-h/2,N=f.x+h/2,V=f.y-h/2,W=f.y+h/2,U=f.z-h/2,s=f.z+h/2,a=r.getAttribute("data-valeur"),l=m.getAttribute("data-valeur");i.x>=I&&i.x<=N&&i.y>=V&&i.y<=W&&i.z>=U&&i.z<=s&&a===l&&(p=!0)}),p||(n=!1)}),n?(v.changeColor("#A3E447"),d.renderCorrectAnswer(),g.anchormanCheer(),P=!0,u.summonStack(2),setTimeout(()=>{y.resetAndRenderZone()},2e3)):(v.changeColor("#FF662F"),d.renderWrongAnswer(),g.anchormanDeception(),e.responses.forEach((r,i)=>{const p=document.querySelector(`#answer${i+1}`),m=document.querySelector(`#boxanswer${i+1}`);p&&(m.setAttribute("color","#FF662F"),p.setAttribute("value",""),p.setAttribute("value",i+1+") "+r.answer))}),P=!0,setTimeout(()=>{y.resetAndRenderZone()},6e3))};const Me=await fetch("./src/components/keyboard/template.html.inc"),Be=await Me.text(),Le=await fetch("./src/components/keyboard/templateInput.html.inc"),Oe=await Le.text(),ce=document.querySelector("#mainScene");let q={},$="";q.render=function(){const e=document.createElement("a-entity");e.id="keyboard",e.innerHTML=Be,ce.appendChild(e),e.addEventListener("click",q.keyClicked),q.renderInput()};q.keyClicked=function(e){d.keyboardSound();const t=e.target.querySelector("a-text").getAttribute("value");if(g.keyPressed(e.target),t==="Del")$=$.slice(0,-1);else if(t==="OK")Q.addUser($,u.getMoney()),q.remove();else{if($.length>=15)return;$+=t}q.updateInput()};q.renderInput=function(){const e=document.createElement("a-entity");e.id="input",e.innerHTML=Oe,ce.appendChild(e),q.updateInput()};q.updateInput=function(){document.querySelector("#input-text").setAttribute("value",$+"_")};q.remove=function(){const e=document.querySelector("#keyboard");e.setAttribute("animation",{property:"position",to:"0.99 -3 -36",dur:1e3,easing:"easeInOutQuad"}),document.querySelector("#input").setAttribute("animation",{property:"position",to:"0.99 -3 -36",dur:1e3,easing:"easeInOutQuad"}),c.removeEndingScreen(),setTimeout(()=>{e.parentNode.removeChild(e);const o=document.querySelector("#input");o.parentNode.removeChild(o),c.startGame()},1e3)};const Qe=await fetch("./src/components/rounds/template.html.inc"),ze=await Qe.text(),Fe=await fetch("./src/components/rounds/templateExplanation.html.inc"),Re=await Fe.text(),He=await fetch("./src/components/rounds/templateMenu.html.inc"),Pe=await He.text(),_e=await fetch("./src/components/rounds/templateEnding.html.inc"),De=await _e.text(),j=document.querySelector("#mainScene");let c={},oe=!1,H=["TickingAway","FindThePlace","SortItOut","SorryNotSoRich"],S="",T=1;c.startGame=async function(){u.setMoney(0),T=1,u.renderMoneyZone(),Z.renderZone(),document.querySelector("#anchorman").addEventListener("click",c.clickOnAnchorman),c.renderMenu()};c.nextRound=async function(){if(T>H.length){setTimeout(()=>{c.endGame()},1e3);return}console.log("Round: ",T," - ",H[T-1]),T!=1&&(S==="FindThePlace"?w.removeQuizZone():S==="TickingAway"?A.removeQuizZone():S==="SortItOut"?y.removeSortItOutZone():S==="SorryNotSoRich"&&E.removeQuizZone()),setTimeout(()=>{S=H[T-1]},500),c.renderExplanationZone(Ge[H[T-1]]);const e=async()=>{oe?setTimeout(e,100):(setTimeout(()=>{S==="FindThePlace"?(w.renderPropositionsZone(),w.renderQuestion()):S==="TickingAway"?(A.renderQuizZone(),A.newQuestion(),A.startTimer()):S==="SortItOut"?(y.resetCounter(),y.renderSortItOutZone()):S==="SorryNotSoRich"&&E.renderQuizZone()},500),T++)};e()};c.endGame=function(){S==="FindThePlace"?w.removeQuizZone():S==="TickingAway"?A.removeQuizZone():S==="SortItOut"?y.removeSortItOutZone():S==="SorryNotSoRich"&&E.removeQuizZone(),setTimeout(()=>{q.render(),u.removeMoneyZone();const e=document.createElement("a-entity");e.id="endingScreen",e.innerHTML=De.replace("{{final-score}}",u.getMoney()),j.appendChild(e)},1e3)};c.explainGame=function(e){const t=document.createElement("a-entity");t.id="explanationZone",t.innerHTML=ze.replace("{{message}}",e),console.log("Explanation: ",t),j.appendChild(t),setTimeout(()=>{c.removeExplanation()},3e3)};c.removeEndingScreen=function(){const e=document.querySelector("#endingScreen");e.setAttribute("animation",{property:"position",to:"0 -6 0",dur:600,easing:"easeInOutQuad"}),setTimeout(()=>{e.remove(),Z.remove()},700)};c.removeExplanation=function(){explanationZone.setAttribute("animation",{property:"position",to:"0 -6 0",dur:600,easing:"easeInOutQuad"}),setTimeout(()=>{document.querySelector("#explanationZone").remove()},700)};let Y=!1;c.clickOnAnchorman=function(){Y||(S==="FindThePlace"?c.explainGame("Find the correct place"):S==="TickingAway"?c.explainGame("Answer the questions before the timer runs out"):S==="SortItOut"?c.explainGame("Sort the answers in the correct order"):S==="SorryNotSoRich"&&c.explainGame("Bet on the correct answer but save some money!"),Y=!0,setTimeout(()=>{c.removeExplanation(),setTimeout(()=>{Y=!1},1e3)},5e3))};const Ge={FindThePlace:`Find the place 
 In each round, you will be dropped in a place in the world. 
 Then, you will have to guess between 4 propositions where you were. 
 Look for signs, driving side, flags and other clues ! 
 Each good answer gives you 300$`,TickingAway:`Ticking away 
 You will have 30 seconds to answer as much questions as you can. 
 But be careful, a wrong answer will make you lose some time! 
 Each good answer gives you 100$`,SortItOut:`Sort it out 
 Sort the answers in the crescent order by moving the colored cubes in the right box. 
 Then, lock your answer and cross your fingers ! 
 Each good answer gives you 200$`,SorryNotSoRich:`Sorry not so rich 
 Bet on the correct answer by spreading your money between the 4 propositions. 
 But be careful, you will lose the money you bet on wrong answers !`};c.renderExplanationZone=function(e){oe=!0;const t=document.createElement("a-entity");t.id="explanationZone",t.innerHTML=Re.replace("{{explanation}}",e),j.appendChild(t),document.querySelector("#validButton-explanation").addEventListener("click",c.removeExplanationZone)};c.removeExplanationZone=function(){oe=!1,console.log("Remove explanation zone");const e=document.querySelector("#explanationZone");e.setAttribute("animation",{property:"position",to:"0 -6 0",dur:600,easing:"easeInOutQuad"}),setTimeout(()=>{e.remove()},700)};c.renderMenu=function(){const e=document.createElement("a-entity");e.id="menuZone",e.innerHTML=Pe,j.appendChild(e),document.querySelectorAll(".startButton-menu").forEach(o=>{o.addEventListener("click",n=>{c.removeMenu(),window.category=n.target.dataset.category})})};c.removeMenu=function(){const e=document.querySelector("#menuZone");e.setAttribute("animation",{property:"position",to:"0 -6 0",dur:600,easing:"easeInOutQuad"}),d.renderOST(),setTimeout(()=>{e.remove(),c.nextRound()},700)};ie.setupControllerClickHandler();function ue(){requestAnimationFrame(ue)}ue();setTimeout(()=>{console.log("Games reimported"),c.startGame(),Z.renderZone()},5e3);
